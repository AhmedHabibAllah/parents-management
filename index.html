<!DOCTYPE html>
<html lang="ar">

<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</title>

  <style>
    :root {
      --primary-color: #1976d2;
      --bg-color: #f0f8ff;
      --text-color: #000000;
      --sidebar-width: 350px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      margin: 0;
      min-height: 100vh;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      direction: rtl;
      font-size: 20px;
    }

    /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª (Centered Boxes) */
    .center-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10;
      background: var(--bg-color);
      transition: all 0.3s;
      overflow: auto;
      padding: 20px;
      box-sizing: border-box;
      max-height: 100vh;
    }

    .box {
      background: white;
      padding: 40px;
      border-radius: 12px;
      width: 99.5%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      text-align: center;
      max-height: calc(100vh - 60px);
      overflow: auto;
    }

    .box-large {
      width: 99.5%;
      height: auto;
      max-width: none;
      max-height: calc(100vh - 60px);
      overflow: auto;
    }

    h2 {
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    .btn {
      width: 100%;
      padding: 0 16px;
      height: 60px;
      margin-bottom: 10px;
      font-size: 22px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: var(--primary-color);
      color: white;
      transition: 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 800;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn-outline {
      background: #ffffff;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
      font-weight: 700;
    }

    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }

    .btn-secondary {
      background: #777;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      box-sizing: border-box;
      font-family: inherit;
      font-size: 20px;
      font-weight: 600;
    }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Dashboard Layout) */
    #dashboardScreen {
      display: none;
      min-height: 100vh;
      width: 100%;
      position: relative;
      overflow: auto;
    }

    .main-content {
      width: 100%;
      height: 100%;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      transition: margin-left 0.3s;
    }

    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    .table-container {
      background: #fafafa;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      overflow-x: auto;
      max-height: calc(100vh - 150px);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    thead {
      background: #f7f7f7;
      color: #000;
      position: sticky;
      top: 0;
      z-index: 5;
    }

    th,
    td {
      padding: 20px;
      text-align: right;
      border-bottom: 1px solid #ccc;
      white-space: nowrap;
      color: #000;
      font-weight: 600;
      background: #fff;
      font-size: 20px;
    }

    .num-cell {
      direction: ltr;
      font-family: 'Segoe UI', sans-serif;
    }

    tr:hover {
      background-color: #f9f9f9;
      cursor: pointer;
    }

    tr.selected {
      background-color: #e3f2fd;
      border-right: 4px solid var(--primary-color);
    }

    /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100%;
      width: var(--sidebar-width);
      background: white;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 100;
      display: flex;
      flex-direction: column;
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 20px;
      background: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ (History) */
    .sidebar-right {
      position: fixed;
      right: 0;
      top: 0;
      height: 100%;
      width: var(--sidebar-width);
      background: white;
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 100;
      display: flex;
      flex-direction: column;
    }

    .sidebar-right.active {
      transform: translateX(0);
    }

    .sidebar-content {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .info-group {
      margin-bottom: 15px;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
    }

    .sidebar-right .sidebar-header {
      padding: 20px;
      background: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .info-value {
      font-weight: bold;
      color: #333;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }

    .close-sidebar {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }

    /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    .settings-group {
      margin-bottom: 20px;
      text-align: right;
    }

    .settings-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    textarea.excel-input {
      height: 150px;
      resize: none;
      font-family: monospace;
      font-size: 12px;
    }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    .excel-preview-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 10px;
    }

    .excel-preview-table th,
    .excel-preview-table td {
      border: 1px solid #ddd;
      padding: 14px 16px;
      text-align: center;
      border-collapse: collapse;
      font-size: 16px;
    }

    .excel-preview-table th {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: white;
      position: sticky;
      top: 0;
      font-weight: 700;
      font-size: 17px;
    }

    .excel-preview-table tbody tr {
      transition: background-color 0.2s;
    }

    .excel-preview-table tbody tr:hover {
      background-color: #f5f5f5 !important;
    }

    .excel-preview-table tbody tr:nth-child(even) {
      background-color: #fafafa;
    }

    .excel-preview-table td[contenteditable="true"]:focus {
      background: #e3f2fd;
      outline: 2px solid var(--primary-color);
      z-index: 1;
    }

    .qr-container {
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
    }

    /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - ØªØµÙ…ÙŠÙ… Ø£ÙƒØ¨Ø± ÙˆÙˆØ§Ø¶Ø­ ÙˆÙ…ØªØ¬Ø§ÙˆØ¨ */
    .stat-btn {
      padding: 0 20px;
      height: 60px;
      font-size: 20px;
      border-radius: 10px;
      margin-left: 6px;
      background: linear-gradient(90deg, #1976d2, #43a047);
      color: #fff;
      border: none;
      box-shadow: 0 6px 18px rgba(25, 118, 210, 0.18);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .stat-outline {
      background: linear-gradient(90deg, #ffb74d, #ff8a65);
      color: #fff;
    }

    .stats-box {
      background: #ffffff;
      color: #000;
      font-weight: 700;
    }

    .stats-box h3 {
      font-size: 24px;
      color: #000;
      margin: 6px 0 12px;
    }

    .stats-box .excel-preview-table th,
    .stats-box .excel-preview-table td {
      font-size: 16px;
      padding: 12px;
      font-weight: 700;
    }

    .stats-box .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 12px;
    }

    .stats-box .controls select,
    .stats-box .controls button {
      font-size: 16px;
      padding: 8px 12px;
      border-radius: 8px;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª */
    .chart-type-btn {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
      transition: 0.2s;
    }

    .chart-type-btn:hover {
      background: #f0f0f0;
    }

    .chart-type-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    /* Ù…ØªØ¬Ø§ÙˆØ¨: Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      .box {
        padding: 18px;
        width: 95%;
      }

      .btn {
        padding: 10px;
        font-size: 14px;
      }

      .stat-btn {
        padding: 10px;
        font-size: 14px;
      }

      .excel-preview-table th,
      .excel-preview-table td {
        font-size: 13px;
      }

      table {
        min-width: 600px;
      }
    }

    @media (max-width: 420px) {
      .header-bar {
        flex-direction: column;
        gap: 8px;
      }

      .header-bar h3 {
        font-size: 18px;
      }

      .stat-btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>

  <!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù -->
  <div class="center-screen" id="employeeScreen">
    <div class="box" style="max-width: 600px; margin: 0 auto;">
      <h2>ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>
      <p style="color:#666; margin-bottom:20px;">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
      <div id="employeeButtons">
        <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‡Ù†Ø§ -->
      </div>
      <button class="btn btn-outline" onclick="openSettingsAdmin()" style="margin-top:20px;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Dashboard) -->
  <div id="dashboardScreen">

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content" id="mainContent">
      <h1 style="text-align:center; font-size:28px; color:var(--primary-color); font-weight:800; margin:6px 0 12px;">
        Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ø§Ù„Ø±ÙˆØ§Ø¨ÙŠ</h1>
      <div class="header-bar">
        <h3 id="employeeName" style="margin:0;"></h3>
        <div>
          <button class="btn btn-secondary" onclick="goBack()" style="width:auto; display:inline-flex;">Ø®Ø±ÙˆØ¬</button>
          <button class="stat-btn" onclick="openStats()" style="width:auto; display:inline-flex; margin-right:8px;">ğŸ“Š
            Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
          <button class="btn btn-outline" onclick="openEmployeeSettings()"
            style="width:auto; display:inline-flex;">âš™ï¸</button>
        </div>
      </div>

      <div class="table-container">
        <table id="parentsTable">
          <thead>
            <tr>
              <th>Ù…</th>
              <th>Ø±Ù‚Ù… Ø§Ù„ÙˆÙ„ÙŠ</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
              <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
              <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø¯ÙˆØ±</th>
              <th>Ø±ØµÙŠØ¯ Ù1</th>
              <th>Ø±ØµÙŠØ¯ Ù2</th>
              <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Ø§Ù„ØµÙÙˆÙ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) -->
    <div class="sidebar" id="detailsSidebar">
      <div class="sidebar-header">
        <span id="sidebarTitle">ØªÙØ§ØµÙŠÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</span>
        <div style="display:flex; gap:8px; align-items:center;">
          <button class="close-sidebar" onclick="openEmployeeSettings()" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù">âš™ï¸</button>
          <button class="close-sidebar" onclick="closeSidebar()">âœ•</button>
        </div>
      </div>

      <div class="sidebar-content">
        <div id="sidebarInfo"></div>

        <!-- QR Code -->
        <div id="qrCodeContainer" class="qr-container"></div>

        <hr style="border:0; border-top:1px solid #eee; margin:20px 0 10px;">
        <h3
          style="color: var(--primary-color); margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px;">
          Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>

        <label class="info-label">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</label>
        <input type="number" id="callCountInput" placeholder="0">

        <label class="info-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <textarea id="notesInput" rows="4" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§..."></textarea>

        <label class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</label>
        <select id="callStatusSelect"></select>

        <label class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…</label>
        <input type="date" id="nextCallDateInput">

        <button class="btn" onclick="saveParentInteraction()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>

        <div class="action-buttons">
          <div style="display: flex; gap: 10px; align-items: center;">
            <button class="btn" style="background:#25D366; flex: 1; margin-bottom:0;" onclick="openWhatsApp()">
              ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨
            </button>
            <div
              style="display: flex; align-items: center; background: #f8f9fa; padding: 0 10px; border-radius: 8px; height: 60px; border: 1px solid #ccc;">
              <input type="checkbox" id="whatsappSentCheckbox" style="width: 20px; height: 20px; margin: 0;">
              <label for="whatsappSentCheckbox"
                style="margin-right: 8px; font-size: 14px; cursor: pointer; white-space: nowrap;">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</label>
            </div>
          </div>
          <button class="btn" style="background:#ff9800; margin-bottom:0;" onclick="openPayment()">
            ğŸ’³ Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
          </button>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ (Ø³Ø¬Ù„ Ø¢Ø®Ø± Ø§ØªØµØ§Ù„) -->
    <div class="sidebar-right" id="historySidebar">
      <div class="sidebar-header">
        <span>Ø³Ø¬Ù„ Ø¢Ø®Ø± Ø§ØªØµØ§Ù„</span>
        <button class="close-sidebar" onclick="closeSidebar()">âœ•</button>
      </div>
      <div class="sidebar-content" id="historyInfo"></div>
    </div>

  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->

  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† (Password masked) -->
  <div class="center-screen" id="adminLoginScreen" style="display:none; z-index:500;">
    <div class="box" style="width:380px; max-width:95%; margin:0 auto; text-align:right;">
      <h2 style="text-align:center;">ğŸ”’ Ø¯Ø®ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
      <div style="padding:6px 0; text-align:right;">
        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†</label>
        <input type="password" id="admin_login_input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
          style="width:100%; padding:10px; margin-top:6px;">
        <div style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end;">
          <button class="btn" onclick="submitAdminLogin()">Ø¯Ø®ÙˆÙ„</button>
          <button class="btn btn-secondary" onclick="closeAdminLogin()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </div>
  </div>

  <div class="center-screen" id="settingsScreen" style="display:none; z-index:20;">
    <div class="box"
      style="width: 98%; max-width:none; height:98%; display:flex; flex-direction:column; text-align: right;">
      <h2 style="text-align:center;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>

      <div style="flex:1; overflow-y: auto; padding: 5px;">

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¸Ù‡Ø± ÙˆÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div style="display:flex; gap:20px; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;">
          <div style="flex:1;">
            <label>ğŸ¨ Ù„ÙˆÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
            <input type="color" id="themeColor" style="height:40px; padding:2px;">
          </div>
          <div style="flex:2;">
            <label>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹</label>
            <input type="text" id="paymentUrlSetting" style="margin-bottom:0;">
          </div>
        </div>

        <div class="settings-group" style="border-bottom:1px solid #eee; padding-bottom:15px;">
          <label>ğŸ” ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</label>
          <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px;">
            <input type="text" id="pass_emp1" placeholder="Ø±Ù…Ø² Ù…ÙˆØ¸Ù 1" style="margin:0;">
            <input type="text" id="pass_emp2" placeholder="Ø±Ù…Ø² Ù…ÙˆØ¸Ù 2" style="margin:0;">
            <input type="text" id="pass_emp3" placeholder="Ø±Ù…Ø² Ù…ÙˆØ¸Ù 3" style="margin:0;">
            <input type="text" id="pass_emp4" placeholder="Ø±Ù…Ø² Ù…ÙˆØ¸Ù 4" style="margin:0;">
          </div>

          <label style="display:block; margin-top:12px;">ğŸ§‘â€ğŸ’¼ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)</label>
          <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-top:6px;">
            <input type="text" id="name_emp1" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù 1" style="margin:0;">
            <input type="text" id="name_emp2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù 2" style="margin:0;">
            <input type="text" id="name_emp3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù 3" style="margin:0;">
            <input type="text" id="name_emp4" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù 4" style="margin:0;">
          </div>
        </div>

        <div class="settings-group" style="border-bottom:1px solid #eee; padding-bottom:15px;">
          <label>ğŸ“ Ø®ÙŠØ§Ø±Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (Ø¶Ø¹ ÙƒÙ„ Ø®ÙŠØ§Ø± ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯)</label>
          <textarea id="statusOptionsInput" placeholder="Ù…Ø´ØºÙˆÙ„
Ù„Ù… ÙŠØ±Ø¯
ØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚" style="height:90px; width:100%; padding:12px; box-sizing:border-box;"></textarea>
        </div>

        <div class="settings-group">
          <label> Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Excel)</label>
          <label
            style="font-size:1.1em; color:var(--primary-color); border-bottom:2px solid #eee; padding-bottom:5px;">ğŸ“‚
            Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ù†Ø³Ø®/Ù„ØµÙ‚ Excel)</label>
          <p style="font-size:12px; color:#666; margin-bottom:10px;">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¯Ù†Ø§Ù‡ØŒ Ø«Ù… Ø§Ø¶ØºØ· "Ù„ØµÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª
            Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§ØªÙ‡.</p>
          <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center; flex-wrap:wrap;">
            <select id="importEmpSelect"
              style="width:200px; margin:0; font-weight:bold; border:2px solid var(--primary-color);">
              <option value="emp1">Ù…ÙˆØ¸Ù 1</option>
              <option value="emp2">Ù…ÙˆØ¸Ù 2</option>
              <option value="emp3">Ù…ÙˆØ¸Ù 3</option>
              <option value="emp4">Ù…ÙˆØ¸Ù 4</option>
            </select>
            <button class="btn btn-outline" onclick="loadDataToGrid()" style="width:auto; margin:0;">ğŸ“‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
              Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
            <button class="btn btn-outline" onclick="togglePasteArea()" style="width:auto; margin:0;">ğŸ“‹ Ù„ØµÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª
              Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn btn-outline" onclick="deleteEmployeeDataDB()"
              style="width:auto; margin:0; color:red; border-color:red; background:#fff5f5;">âŒ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
              Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</button>
          </div>

          <textarea id="excelPasteArea" class="excel-input" style="display:none; margin-bottom:10px;"
            placeholder="Ø§Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¥ÙƒØ³Ù„ ÙˆØ§Ù„ØµÙ‚Ù‡Ø§ Ù‡Ù†Ø§... (ØªØ£ÙƒØ¯ Ù…Ù† ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ù… - Ø±Ù‚Ù… Ø§Ù„ÙˆÙ„ÙŠ - Ø§Ù„Ø§Ø³Ù… - Ø§Ù„Ù‡ÙˆÙŠØ© - Ø§Ù„Ø¬ÙˆØ§Ù„ - Ø§Ù„Ù…Ø¯ÙˆØ± - Ù1 - Ù2 - Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)"
            oninput="convertPasteToGrid()">
        </textarea>

          <div id="gridContainer" style="max-height:300px; overflow:auto; border:1px solid #ddd; border-radius:8px;">
            <p style="text-align:center; padding:20px; color:#999;">Ø§Ø®ØªØ± "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" Ø£Ùˆ "Ù„ØµÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ù„Ø¨Ø¯Ø¡
            </p>
          </div>
        </div>

      </div>

      <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="btn" onclick="saveSettingsAndData(false, this)">ğŸ’¾ Ø­ÙØ¸ (Ø¨Ø¯ÙˆÙ† Ø¥ØºÙ„Ø§Ù‚)</button>
        <button class="btn btn-outline" onclick="saveSettingsAndData(true, this)">ğŸšª Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
        <button class="btn btn-outline" onclick="openAdvancedStats()">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</button>
        <button class="btn btn-secondary" onclick="closeSettings()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„) -->
  <div class="center-screen" id="adminScreen" style="display:none; z-index:30;">

    <!-- Ø´Ø§Ø´Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø©) -->
    <div class="center-screen" id="employeeSettingsScreen" style="display:none; z-index:520;">
      <div class="box" style="width:420px; max-width:95%; margin:0 auto; text-align:right;">
        <h2 style="text-align:center;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h2>
        <div id="employeeSettingsTitle" style="text-align:center; font-weight:700; margin-bottom:8px; color:#333;">
        </div>
        <div style="padding:6px 0;">
          <label>ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input type="password" id="emp_pass_input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">
          <label style="margin-top:10px; display:block;">ğŸ¨ ÙˆØ§Ø¬Ù‡Ø© Ø®Ø§ØµØ©</label>
          <input type="color" id="emp_theme_input" style="height:40px; padding:2px;">
          <div style="margin-top:8px; display:flex; gap:8px;">
            <button class="btn btn-outline" onclick="resetEmployeeTheme()" style="width:auto;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
            <span style="align-self:center; color:#666; font-size:13px;">(Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø®Ø§ØµØ© Ø¨Ø­Ø³Ø§Ø¨Ùƒ ÙÙ‚Ø·)</span>
          </div>
        </div>
        <div style="display:flex; gap:10px; margin-top:10px;">
          <button class="btn" onclick="saveEmployeeSettings()">Ø­ÙØ¸</button>
          <button class="btn btn-secondary" onclick="closeEmployeeSettings()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
    <div class="box box-large" style="display:flex; flex-direction:column;">
      <h2>ğŸ”§ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„ (ÙˆØ¶Ø¹ Ø§Ù„Ø¥ÙƒØ³Ù„)</h2>
      <p style="color:#666; font-size:14px;">ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‡Ù†Ø§ ÙˆÙ„ØµÙ‚Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¥ÙƒØ³Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ø«Ù… Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§ ÙˆÙ„ØµÙ‚Ù‡Ø§ Ù‡Ù†Ø§
        Ù„Ù„Ø­ÙØ¸. <br> <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­ÙØ¸ Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ
        Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø£Ø¯Ù†Ø§Ù‡.</p>

      <textarea id="adminDataInput"
        style="flex:1; white-space:pre; overflow:auto; font-family:monospace; font-size:12px; border:2px solid var(--primary-color);"
        placeholder="Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."></textarea>

      <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn" onclick="saveAdminDataFull()" style="background:#d32f2f;">ğŸ’¾ Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙ„</button>
        <button class="btn btn-outline" onclick="loadAdminData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn btn-secondary" onclick="closeAdminPanel()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://emrsfzmaqmfavehrdppw.supabase.co',
      'sb_publishable_dmZ-1l-BmDzIteU1IaSjnw_3TMkHMhw'
    );

    // ===== Usage tracking =====
    const pushUsageEvent = async (evt) => {
      try {
        await supabase.from('employee_usage').insert(evt);
      } catch (e) {
        console.debug('Supabase insert for usage event failed:', e?.message || e);
      }
    };

    const sessionStartTimes = {};

    const recordLogin = (employee) => {
      const now = Date.now();
      sessionStartTimes[employee] = now;
      pushUsageEvent({ employee, type: 'login', ts: new Date().toISOString() });
    };

    const recordLogout = (employee) => {
      try {
        const start = sessionStartTimes[employee];
        if (start) {
          const end = Date.now();
          const duration = Math.max(0, end - start);
          pushUsageEvent({
            employee,
            type: 'session',
            start: new Date(start).toISOString(),
            end: new Date(end).toISOString(),
            duration_ms: duration
          });
          delete sessionStartTimes[employee];
        } else {
          pushUsageEvent({ employee, type: 'logout', ts: new Date().toISOString() });
        }
      } catch (e) { console.error(e); }
    };

    let currentEmployee = "";
    let currentParentId = null;
    let currentParentCode = "";
    let currentParentPhone = "";
    let currentParentIdentity = "";

    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    let appConfig = {
      theme: '#1976d2',
      paymentUrl: 'https://google.com',
      passwords: { emp1: '', emp2: '', emp3: '', emp4: '' },
      employeeNames: { emp1: 'Ù…ÙˆØ¸Ù 1', emp2: 'Ù…ÙˆØ¸Ù 2', emp3: 'Ù…ÙˆØ¸Ù 3', emp4: 'Ù…ÙˆØ¸Ù 4' },
      employeeThemes: {},
      statusOptions: "Ù…Ø´ØºÙˆÙ„\nÙ„Ù… ÙŠØ±Ø¯\nÙ…Ø¹ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯\nÙ…Ø¹ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ù‚Ø§Ø¯Ù…\nØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯"
    };

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function saveConfigToDB() {
      try {
        const { error } = await supabase.from('app_config').upsert({
          id: 1,
          config: appConfig,
          updated_at: new Date().toISOString()
        });
        if (error) {
          console.error('Error saving settings to DB:', error);
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù†Ù†Ø´Ø¦Ù‡
          if (error.message.includes('does not exist')) {
            await createTablesIfNotExist();
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            await saveConfigToDB();
          }
        }
      } catch (e) {
        console.error('Failed to save config:', e);
      }
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
    async function createTablesIfNotExist() {
      try {
        console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©...');

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ app_config Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        const { error: configError } = await supabase.rpc('create_tables_if_not_exist');

        if (configError) {
          console.log('RPC ØºÙŠØ± Ù…ØªÙˆÙØ±ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… SQL Ù…Ø¨Ø§Ø´Ø±Ø©...');
          // Ø³Ù†Ù‚ÙˆÙ… Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ÙØ±Ø¯ÙŠØ©
        }
      } catch (e) {
        console.error('Error in createTablesIfNotExist:', e);
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function loadSettings() {
      try {
        const { data, error } = await supabase.from('app_config').select('config').eq('id', 1).single();

        if (error) {
          console.log('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:', error.message);
          // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          await saveConfigToDB();
        } else if (data && data.config) {
          const parsed = data.config;
          appConfig = Object.assign({}, appConfig, parsed);

          // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
          appConfig.passwords = Object.assign({ emp1: '', emp2: '', emp3: '', emp4: '' }, appConfig.passwords || {});
          appConfig.employeeNames = Object.assign({
            emp1: 'Ù…ÙˆØ¸Ù 1',
            emp2: 'Ù…ÙˆØ¸Ù 2',
            emp3: 'Ù…ÙˆØ¸Ù 3',
            emp4: 'Ù…ÙˆØ¸Ù 4'
          }, appConfig.employeeNames || {});
          appConfig.employeeThemes = Object.assign({}, appConfig.employeeThemes || {});

          console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:', appConfig);
        }
      } catch (e) {
        console.error('Failed to load appConfig from DB:', e);
      }

      applyTheme();
      renderEmployeeButtons();
    }

    function applyTheme() {
      const empTheme = (currentEmployee && appConfig.employeeThemes && appConfig.employeeThemes[currentEmployee]);
      document.documentElement.style.setProperty('--primary-color', empTheme || appConfig.theme);
    }

    function getEmployeeLabel(emp) {
      return (appConfig.employeeNames && appConfig.employeeNames[emp]) || emp;
    }

    function renderEmployeeButtons() {
      const container = document.getElementById('employeeButtons');
      container.innerHTML = '';
      ['emp1', 'emp2', 'emp3', 'emp4'].forEach((emp) => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.innerText = `ğŸ‘¤ ${getEmployeeLabel(emp)}`;
        btn.onclick = () => checkPasswordAndLogin(emp);
        container.appendChild(btn);
      });
    }

    window.checkPasswordAndLogin = (emp) => {
      const pass = appConfig.passwords[emp];
      if (pass && pass.trim() !== "") {
        const input = prompt("ğŸ”’ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        if (input !== pass) {
          alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
          return;
        }
      }
      showDataForEmployee(emp);
      try { recordLogin(emp); } catch (e) { console.error(e); }
    };

    // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù - Ù…Ø¹Ø¯Ù„ Ø¨Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
    window.showDataForEmployee = async (employee) => {
      console.log(`Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ¸Ù: ${employee}`);
      currentEmployee = employee;
      applyTheme();

      document.getElementById("employeeName").innerText = "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - " + getEmployeeLabel(employee);

      try {
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const { data, error } = await supabase
          .from("parents")
          .select("*")
          .eq("employee", employee)
          .order("serial_no");

        console.log("Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù„Ù„Ù…ÙˆØ¸Ù", employee, ":", { data, error });

        if (error) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);

          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù†Ù†Ø´Ø¦ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
          if (error.message.includes('does not exist') || error.message.includes('relation') || error.code === '42P01') {
            await createSampleData(employee);
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await showDataForEmployee(employee);
            return;
          }

          const tbody = document.getElementById("tableBody");
          tbody.innerHTML = `<tr><td colspan='9' style='text-align:center; color:red;'>
          Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}
          <br><button onclick="showDataForEmployee('${employee}')" style="margin-top:10px; padding:5px 15px; background:#1976d2; color:white; border:none; border-radius:5px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        </td></tr>`;
          return;
        }

        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        if (!data || data.length === 0) {
          tbody.innerHTML = `<tr><td colspan='9' style='text-align:center; color:orange;'>
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ¸Ù ${getEmployeeLabel(employee)}. 
          <br>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.
        </td></tr>`;
        } else {
          // Ø¯Ù…Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
          const codes = data.map(p => p.parent_code).filter(c => c);
          let interactions = [];

          if (codes.length > 0) {
            const { data: intData, error: intError } = await supabase
              .from('interactions')
              .select('*')
              .in('parent_code', codes)
              .eq('employee', employee);

            if (!intError && intData) {
              interactions = intData;
            }
          }

          const intMap = {};
          interactions.forEach(i => intMap[i.parent_code] = i);

          data.forEach(p => {
            const interaction = intMap[p.parent_code] || {};
            const tr = document.createElement("tr");
            tr.onclick = () => selectParent(tr, { ...p, ...interaction });
            tr.innerHTML = `
            <td>${p.serial_no || '-'}</td>
            <td>${p.parent_code || '-'}</td>
            <td><strong>${p.parent_name || '-'}</strong></td>
            <td>${p.identity_no || '-'}</td>
            <td class="num-cell" style="text-align:right;">${p.phone || '-'}</td>
            <td class="num-cell">${(p.carried_balance || 0).toLocaleString('en-US')}</td>
            <td class="num-cell">${(p.term1_balance || 0).toLocaleString('en-US')}</td>
            <td class="num-cell">${(p.term2_balance || 0).toLocaleString('en-US')}</td>
            <td class="num-cell" style="color:${(p.final_balance || 0) > 0 ? 'red' : 'green'}">${(p.final_balance || 0).toLocaleString('en-US')}</td>
          `;
            tbody.appendChild(tr);
          });
        }

        document.getElementById("employeeScreen").style.display = "none";
        document.getElementById("dashboardScreen").style.display = "block";

      } catch (e) {
        console.error("Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:", e);
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = `<tr><td colspan='9' style='text-align:center; color:red;'>
        Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${e.message}
        <br><button onclick="showDataForEmployee('${employee}')" style="margin-top:10px; padding:5px 15px; background:#1976d2; color:white; border:none; border-radius:5px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
      </td></tr>`;
      }
    };

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
    async function createSampleData(employee) {
      console.log(`Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù: ${employee}`);

      const sampleData = {
        emp1: [
          { parent_code: 'EMP1_001', parent_name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', identity_no: '1234567890', phone: '0501234567', serial_no: 1, carried_balance: 1000, term1_balance: 500, term2_balance: 300, final_balance: 1800 },
          { parent_code: 'EMP1_002', parent_name: 'Ø³Ø§Ù„Ù… Ø¹Ù„ÙŠ', identity_no: '2345678901', phone: '0512345678', serial_no: 2, carried_balance: 2000, term1_balance: 1000, term2_balance: 500, final_balance: 3500 }
        ],
        emp2: [
          { parent_code: 'EMP2_001', parent_name: 'Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯', identity_no: '3456789012', phone: '0523456789', serial_no: 1, carried_balance: 1500, term1_balance: 750, term2_balance: 250, final_balance: 2500 },
          { parent_code: 'EMP2_002', parent_name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯', identity_no: '4567890123', phone: '0534567890', serial_no: 2, carried_balance: 3000, term1_balance: 1500, term2_balance: 800, final_balance: 5300 }
        ],
        emp3: [
          { parent_code: 'EMP3_001', parent_name: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†', identity_no: '5678901234', phone: '0545678901', serial_no: 1, carried_balance: 1200, term1_balance: 600, term2_balance: 300, final_balance: 2100 }
        ],
        emp4: [
          { parent_code: 'EMP4_001', parent_name: 'Ù†Ø§ØµØ± ÙÙ‡Ø¯', identity_no: '6789012345', phone: '0556789012', serial_no: 1, carried_balance: 2500, term1_balance: 1200, term2_balance: 600, final_balance: 4300 }
        ]
      };

      const data = sampleData[employee] || [];

      if (data.length > 0) {
        try {
          // Ø¥Ø¶Ø§ÙØ© employee Ø¥Ù„Ù‰ ÙƒÙ„ Ø³Ø¬Ù„
          const records = data.map(item => ({ ...item, employee }));

          const { error } = await supabase
            .from('parents')
            .insert(records);

          if (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', error);
          } else {
            console.log(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${data.length} Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ù…ÙˆØ¸Ù ${employee}`);
          }
        } catch (e) {
          console.error('Ø®Ø·Ø£ ÙÙŠ createSampleData:', e);
        }
      }
    }

    // Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ„ÙŠ Ø£Ù…Ø± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
    window.selectParent = (tr, data) => {
      // Highlight row
      document.querySelectorAll('tr').forEach(row => row.classList.remove('selected'));
      tr.classList.add('selected');

      // Set Data
      currentParentId = data.id;
      currentParentCode = data.parent_code;
      currentParentPhone = data.phone;
      currentParentIdentity = data.identity_no;

      // Generate QR Code
      const qrContainer = document.getElementById('qrCodeContainer');
      if (currentParentPhone) {
        const cleanPhone = currentParentPhone.replace(/\D/g, '');
        qrContainer.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=tel:${cleanPhone}" alt="QR Call" style="display:block; margin:0 auto;"><span style="font-size:11px; color:#666;">Ø§Ù…Ø³Ø­ Ù„Ù„Ø§ØªØµØ§Ù„</span>`;
      } else {
        qrContainer.innerHTML = '';
      }

      // Populate Sidebar
      const infoDiv = document.getElementById('sidebarInfo');
      const formatLtr = (val) => `<span class="num-cell">${val}</span>`;
      const formatDate = (dateStr) => {
        if (!dateStr) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        try {
          return new Date(dateStr).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
        } catch (e) { return 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­'; }
      };

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ø¬Ù„ Ø§ØªØµØ§Ù„ Ø³Ø§Ø¨Ù‚
      const hasHistory = (data.last_call_status && data.last_call_status.trim() !== "") ||
        (data.call_count > 0) ||
        (data.notes && data.notes.trim() !== "");

      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ (Ø³Ø¬Ù„ Ø¢Ø®Ø± Ø§ØªØµØ§Ù„)
      const historyDiv = document.getElementById('historyInfo');
      historyDiv.innerHTML = `
      <h3 style="color: var(--primary-color); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø¢Ø®Ø± Ø§ØªØµØ§Ù„</h3>
      <div class="info-group"><div class="info-label">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø§ØªØµØ§Ù„</div><div class="info-value">${hasHistory ? formatDate(data.updated_at) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div></div>
      <div class="info-group"><div class="info-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¢Ø®Ø± Ø§ØªØµØ§Ù„</div><div class="info-value" style="white-space: pre-wrap; max-height: 200px; overflow-y: auto; background:#f9f9f9; padding:8px; border-radius:4px;">${(hasHistory && data.notes) ? data.notes : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div></div>
      <div class="info-group"><div class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚</div><div class="info-value" style="color: var(--primary-color);">${(hasHistory && data.last_call_status) ? data.last_call_status : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div></div>
      <div class="info-group"><div class="info-label">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡</div><div class="info-value">${(hasHistory && data.next_call_date) ? data.next_call_date : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div></div>
      <div class="info-group"><div class="info-label">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ Ø³Ø§Ø¨Ù‚Ø§Ù‹</div><div class="info-value">${(hasHistory && data.whatsapp_sent) ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}</div></div>
    `;

      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ (Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±)
      infoDiv.innerHTML = `
      <h3 style="color: var(--primary-color); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px;">Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</h3>
      <div class="info-group"><div class="info-label">Ø§Ù„Ø§Ø³Ù…</div><div class="info-value">${data.parent_name || '-'}</div></div>
      <div class="info-group"><div class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</div><div class="info-value">${formatLtr(data.identity_no || '-')}</div></div>
      <div class="info-group"><div class="info-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</div><div class="info-value">${formatLtr(data.phone || '-')}</div></div>
      <div class="info-group"><div class="info-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div><div class="info-value" style="color:red; font-size: 1.2em;">${formatLtr((data.final_balance || 0).toLocaleString('en-US'))}</div></div>
      <div class="info-group"><div class="info-label">Ø±ØµÙŠØ¯ Ù1</div><div class="info-value">${formatLtr((data.term1_balance || 0).toLocaleString('en-US'))}</div></div>
      <div class="info-group"><div class="info-label">Ø±ØµÙŠØ¯ Ù2</div><div class="info-value">${formatLtr((data.term2_balance || 0).toLocaleString('en-US'))}</div></div>
      <div class="info-group"><div class="info-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø¯ÙˆØ±</div><div class="info-value">${formatLtr((data.carried_balance || 0).toLocaleString('en-US'))}</div></div>
    `;

      // Set Inputs
      document.getElementById('callCountInput').value = data.call_count || 0;
      document.getElementById('notesInput').value = data.notes || "";

      // Populate Status Dropdown
      const statusSelect = document.getElementById('callStatusSelect');
      statusSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© --</option>';
      const options = appConfig.statusOptions.split(/\r?\n|,/).map(s => s.trim()).filter(Boolean);
      options.forEach(opt => { statusSelect.innerHTML += `<option value="${opt}">${opt}</option>`; });
      statusSelect.value = data.last_call_status || "";

      // Date
      document.getElementById('nextCallDateInput').value = data.next_call_date || "";
      document.getElementById('whatsappSentCheckbox').checked = data.whatsapp_sent || false;

      // Show Sidebar
      document.getElementById('detailsSidebar').classList.add('active');
      document.getElementById('historySidebar').classList.add('active');
    };

    window.closeSidebar = () => {
      document.getElementById('detailsSidebar').classList.remove('active');
      document.getElementById('historySidebar').classList.remove('active');
      document.querySelectorAll('tr').forEach(row => row.classList.remove('selected'));
    };

    window.saveParentInteraction = async () => {
      if (!currentParentCode) return alert("Ø®Ø·Ø£: Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±");

      try {
        const callsInput = document.getElementById('callCountInput').value;
        const calls = callsInput ? parseInt(callsInput) : 0;
        const notes = document.getElementById('notesInput').value;
        const status = document.getElementById('callStatusSelect').value;
        const nextDate = document.getElementById('nextCallDateInput').value;
        const whatsappSent = document.getElementById('whatsappSentCheckbox').checked;

        const { error } = await supabase
          .from('interactions')
          .upsert({
            parent_code: currentParentCode,
            employee: currentEmployee,
            call_count: calls,
            notes: notes,
            last_call_status: status,
            next_call_date: nextDate || null,
            whatsapp_sent: whatsappSent,
            updated_at: new Date().toISOString()
          }, {
            onConflict: 'parent_code,employee'
          });

        if (error) {
          console.error('Error saving interaction:', error);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + error.message);
        } else {
          alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…');
          closeSidebar();
          showDataForEmployee(currentEmployee);
        }
      } catch (e) {
        console.error("Network/Fetch error:", e);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ' + e.message);
      }
    };

    window.goBack = () => {
      closeSidebar();
      document.getElementById("dashboardScreen").style.display = "none";
      document.getElementById("employeeScreen").style.display = "flex";
      try { recordLogout(currentEmployee); } catch (e) { console.error(e); }
    };

    window.openSettingsAdmin = () => {
      document.getElementById('admin_login_input').value = '';
      document.getElementById('adminLoginScreen').style.display = 'flex';
      setTimeout(() => { try { document.getElementById('admin_login_input').focus(); } catch (e) { } }, 50);
    };

    window.submitAdminLogin = () => {
      const pass = document.getElementById('admin_login_input').value;
      if (pass === 'admin123') {
        document.getElementById('adminLoginScreen').style.display = 'none';
        // Populate fields
        document.getElementById('themeColor').value = appConfig.theme;
        document.getElementById('paymentUrlSetting').value = appConfig.paymentUrl;
        document.getElementById('pass_emp1').value = appConfig.passwords.emp1 || '';
        document.getElementById('pass_emp2').value = appConfig.passwords.emp2 || '';
        document.getElementById('pass_emp3').value = appConfig.passwords.emp3 || '';
        document.getElementById('pass_emp4').value = appConfig.passwords.emp4 || '';
        document.getElementById('statusOptionsInput').value = appConfig.statusOptions;
        document.getElementById('name_emp1').value = appConfig.employeeNames.emp1 || 'Ù…ÙˆØ¸Ù 1';
        document.getElementById('name_emp2').value = appConfig.employeeNames.emp2 || 'Ù…ÙˆØ¸Ù 2';
        document.getElementById('name_emp3').value = appConfig.employeeNames.emp3 || 'Ù…ÙˆØ¸Ù 3';
        document.getElementById('name_emp4').value = appConfig.employeeNames.emp4 || 'Ù…ÙˆØ¸Ù 4';

        document.getElementById("settingsScreen").style.display = "flex";
      } else {
        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ');
      }
    };

    window.closeAdminLogin = () => { document.getElementById('adminLoginScreen').style.display = 'none'; };

    window.closeSettings = () => {
      document.getElementById("settingsScreen").style.display = "none";
    };

    window.saveAppSettings = async () => {
      appConfig.theme = document.getElementById('themeColor').value;
      appConfig.paymentUrl = document.getElementById('paymentUrlSetting').value;
      appConfig.passwords.emp1 = document.getElementById('pass_emp1').value;
      appConfig.passwords.emp2 = document.getElementById('pass_emp2').value;
      appConfig.passwords.emp3 = document.getElementById('pass_emp3').value;
      appConfig.passwords.emp4 = document.getElementById('pass_emp4').value;
      appConfig.statusOptions = document.getElementById('statusOptionsInput').value;
      appConfig.employeeNames = {
        emp1: document.getElementById('name_emp1').value || 'Ù…ÙˆØ¸Ù 1',
        emp2: document.getElementById('name_emp2').value || 'Ù…ÙˆØ¸Ù 2',
        emp3: document.getElementById('name_emp3').value || 'Ù…ÙˆØ¸Ù 3',
        emp4: document.getElementById('name_emp4').value || 'Ù…ÙˆØ¸Ù 4'
      };

      await saveConfigToDB();
      applyTheme();
      renderEmployeeButtons();
      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…');
    };

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
    window.openEmployeeSettings = () => {
      if (!currentEmployee) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
      document.getElementById('employeeSettingsTitle').innerText = getEmployeeLabel(currentEmployee);
      document.getElementById('emp_pass_input').value = appConfig.passwords[currentEmployee] || '';
      document.getElementById('emp_theme_input').value = (appConfig.employeeThemes && appConfig.employeeThemes[currentEmployee]) || appConfig.theme;
      document.getElementById('employeeSettingsScreen').style.display = 'flex';
    };

    window.saveEmployeeSettings = async () => {
      if (!currentEmployee) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
      const pass = document.getElementById('emp_pass_input').value;
      const theme = document.getElementById('emp_theme_input').value;
      appConfig.passwords[currentEmployee] = pass;
      appConfig.employeeThemes = appConfig.employeeThemes || {};
      appConfig.employeeThemes[currentEmployee] = theme;
      await saveConfigToDB();
      applyTheme();
      alert('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù');
      document.getElementById('employeeSettingsScreen').style.display = 'none';
    };

    window.resetEmployeeTheme = async () => {
      if (!currentEmployee) return;
      if (appConfig.employeeThemes) delete appConfig.employeeThemes[currentEmployee];
      document.getElementById('emp_theme_input').value = appConfig.theme;
      await saveConfigToDB();
      applyTheme();
      alert('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
    };

    window.closeEmployeeSettings = () => { document.getElementById('employeeSettingsScreen').style.display = 'none'; };

    window.openWhatsApp = () => {
      if (!currentParentPhone) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„");
      let phone = currentParentPhone.replace(/\D/g, '');
      window.open(`https://wa.me/${phone}`, '_blank');
    };

    window.openPayment = () => {
      if (!currentParentIdentity) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±");
      window.open(`https://ncle-sms.com/Payment/?id=${currentParentIdentity}`, '_blank');
    };

    // ===== Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª =====
    function formatCurrency(v) {
      return Number(v || 0).toLocaleString('en-US');
    }

    window.openStats = async () => {
      try {
        const { data, error } = await supabase.from('parents').select('*');
        if (error) {
          alert('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ' + error.message);
          console.error(error);
          return;
        }

        // Ø¯Ù…Ø¬ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
        const { data: interactions } = await supabase.from('interactions').select('*');
        let mergedData = data || [];

        if (interactions) {
          const intMap = {};
          interactions.forEach(i => intMap[i.parent_code] = i);
          mergedData = mergedData.map(p => {
            const i = intMap[p.parent_code];
            if (i) {
              return { ...p, ...i };
            }
            return p;
          });
        }

        const byEmp = {};
        const knownEmps = Object.keys(appConfig.employeeNames || {});
        knownEmps.forEach(e => {
          byEmp[e] = { count: 0, sum_final: 0, sum_carried: 0, debtors: 0, total_calls: 0, responded: 0 };
        });

        mergedData.forEach(r => {
          const emp = r.employee || 'emp1';
          if (!byEmp[emp]) byEmp[emp] = { count: 0, sum_final: 0, sum_carried: 0, debtors: 0, total_calls: 0, responded: 0 };
          byEmp[emp].count += 1;
          byEmp[emp].sum_final += Number(r.final_balance || 0);
          byEmp[emp].sum_carried += Number(r.carried_balance || 0);
          if ((r.final_balance || 0) > 0) byEmp[emp].debtors += 1;
          byEmp[emp].total_calls += Number(r.call_count || 0);
          if (r.last_call_status && r.last_call_status.trim() !== '') byEmp[emp].responded += 1;
        });

        const html = ['<div style="padding:10px; max-height:70vh; overflow:auto;">',
          '<h3 style="text-align:center;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† - Ù…Ù„Ø®Øµ</h3>',
          '<div class="controls" style="justify-content:center;">',
          '<select id="statsChartType"><option value="bar">Ø£Ø¹Ù…Ø¯Ø©</option><option value="pie">Ø¯Ø§Ø¦Ø±ÙŠ</option><option value="doughnut">Ø¯ÙˆÙ†Ø§Øª</option><option value="line">Ø®Ø·ÙŠ</option></select>',
          '<button onclick="renderStatsTable()" class="btn">ØªØ­Ø¯ÙŠØ«</button>',
          '<button class="btn" onclick="saveStatsPDF(\'statsScreen\')">Ø­ÙØ¸ ÙƒÙ€ PDF</button>',
          '</div>',
          '<canvas id="statsChart" style="max-width:100%; height:300px;"></canvas>',
          '<div id="statsTable" style="margin-top:10px;"></div>',
          '<div style="text-align:center; margin-top:10px;"><button class="btn btn-secondary" onclick="closeStats()">Ø¥ØºÙ„Ø§Ù‚</button></div>',
          '</div>'].join('');

        const screen = document.createElement('div');
        screen.className = 'center-screen';
        screen.id = 'statsScreen';
        screen.style.zIndex = 520;
        screen.innerHTML = `<div class="box box-large stats-box">${html}</div>`;
        document.body.appendChild(screen);

        window.renderStatsTable = () => {
          const labelsIds = Object.keys(byEmp);
          const labels = labelsIds.map(id => getEmployeeLabel(id));
          const totals = labelsIds.map(k => byEmp[k].sum_final);

          const tableHtml = ['<table class="excel-preview-table"><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</th><th>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th><th>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¯ÙˆØ±</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†ÙˆÙ†</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø¯ÙˆØ¯</th></tr></thead><tbody>'];
          labelsIds.forEach(k => {
            tableHtml.push(`<tr><td>${getEmployeeLabel(k)}</td><td>${byEmp[k].count}</td><td>${formatCurrency(byEmp[k].sum_final)}</td><td>${formatCurrency(byEmp[k].sum_carried)}</td><td>${byEmp[k].debtors}</td><td>${byEmp[k].total_calls}</td><td>${byEmp[k].responded}</td></tr>`);
          });
          tableHtml.push('</tbody></table>');
          document.getElementById('statsTable').innerHTML = tableHtml.join('');

          // Chart
          try {
            const ctx = document.getElementById('statsChart').getContext('2d');
            if (window._statsChart) window._statsChart.destroy();
            const selectedType = document.getElementById('statsChartType')?.value || 'bar';
            window._statsChart = new Chart(ctx, {
              type: selectedType,
              data: { labels, datasets: [{ label: 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', data: totals, backgroundColor: ['#1976d2', '#43a047', '#fbc02d', '#e64a19'] }] },
              options: {
                responsive: true,
                plugins: {
                  legend: { display: selectedType === 'pie' || selectedType === 'doughnut' },
                  title: { display: true, text: 'Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', font: { size: 18, weight: '600' }, color: '#333' }
                },
                scales: selectedType === 'pie' || selectedType === 'doughnut' ? {} : {
                  y: { beginAtZero: true, ticks: { font: { size: 14 }, color: '#333' } },
                  x: { ticks: { font: { size: 14 }, color: '#333' } }
                }
              }
            });
          } catch (e) { console.error('Chart render failed', e); }
        };

        renderStatsTable();
      } catch (e) {
        console.error('Error in openStats:', e);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ' + e.message);
      }
    };

    window.closeStats = () => {
      const s = document.getElementById('statsScreen');
      if (s) s.remove();
    };

    window.togglePasteArea = () => {
      const area = document.getElementById('excelPasteArea');
      area.style.display = area.style.display === 'none' ? 'block' : 'none';
      if (area.style.display === 'block') area.focus();
    };

    window.deleteEmployeeDataDB = async () => {
      const emp = document.getElementById('importEmpSelect').value;
      const empName = getEmployeeLabel(emp);

      if (!confirm(`âš ï¸ ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹!\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ (${empName}) Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`)) return;

      const { error } = await supabase.from('parents').delete().eq('employee', emp);

      if (error) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ' + error.message);
      } else {
        alert(`âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª ${empName} Ø¨Ù†Ø¬Ø§Ø­.`);
        document.getElementById('gridContainer').innerHTML = '<p style="text-align:center; padding:20px; color:red;">ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>';
        document.getElementById('excelPasteArea').value = '';
      }
    };

    // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ù†Øµ Ø±Ù‚Ù… Ø¹Ø±Ø¨ÙŠ/ÙØ§Ø±Ø³ÙŠ/Ù„ØºÙˆÙŠ Ø¥Ù„Ù‰ Ø±Ù‚Ù… JS ØµØ§Ù„Ø­
    const cleanNumber = (input) => {
      if (input === null || input === undefined) return 0;
      let s = input.toString().trim();

      const map = {
        'Ù ': '0', 'Ù¡': '1', 'Ù¢': '2', 'Ù£': '3', 'Ù¤': '4', 'Ù¥': '5', 'Ù¦': '6', 'Ù§': '7', 'Ù¨': '8', 'Ù©': '9',
        'Û°': '0', 'Û±': '1', 'Û²': '2', 'Û³': '3', 'Û´': '4', 'Ûµ': '5', 'Û¶': '6', 'Û·': '7', 'Û¸': '8', 'Û¹': '9'
      };
      s = s.replace(/[Ù -Ù©Û°-Û¹]/g, d => map[d] || d);

      s = s.replace(/[\u200B\u200C\u200E\u200F\u202F\s\u00A0]/g, '');
      s = s.replace(/[\u066C\u060C]/g, '');
      s = s.replace(/\u066B/g, '.');

      if (s.indexOf('.') !== -1 && s.indexOf(',') !== -1) {
        if (s.lastIndexOf(',') > s.lastIndexOf('.')) {
          s = s.replace(/\./g, '');
          s = s.replace(/,/g, '.');
        } else {
          s = s.replace(/,/g, '');
        }
      } else if (s.indexOf(',') !== -1 && s.indexOf('.') === -1) {
        s = s.replace(/,/g, '.');
      } else {
        s = s.replace(/,/g, '');
      }

      s = s.replace(/[^0-9.\-]/g, '');

      const num = parseFloat(s);
      return isNaN(num) ? 0 : num;
    };

    window.loadDataToGrid = async () => {
      const emp = document.getElementById('importEmpSelect').value;
      document.getElementById('excelPasteArea').value = '';
      document.getElementById('gridContainer').innerHTML = '<p style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';

      const { data, error } = await supabase.from("parents").select("*").eq("employee", emp).order("serial_no");

      if (error) {
        console.error('Error loading data:', error);
        document.getElementById('gridContainer').innerHTML = `<p style="text-align:center; color:red;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${error.message}</p>`;
        return;
      }
      renderGrid(data);
      document.getElementById('excelPasteArea').style.display = 'none';
    };

    window.convertPasteToGrid = () => {
      const text = document.getElementById('excelPasteArea').value;
      const rows = text.split("\n");
      const data = [];

      rows.forEach(row => {
        if (!row.trim()) return;
        const c = row.split("\t");
        if (isNaN(parseInt(c[0]))) return;

        data.push({
          serial_no: c[0],
          parent_code: c[1],
          parent_name: c[2],
          identity_no: c[3],
          phone: c[4],
          carried_balance: cleanNumber(c[5]),
          term1_balance: cleanNumber(c[6]),
          term2_balance: cleanNumber(c[7]),
          final_balance: cleanNumber(c[8])
        });
      });
      renderGrid(data);
    };

    function renderGrid(data) {
      if (!data || data.length === 0) {
        document.getElementById('gridContainer').innerHTML = '<p style="text-align:center; padding:20px; color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>';
        return;
      }

      let html = `<table class="excel-preview-table">
      <thead>
        <tr>
          <th>Ø­Ø°Ù</th><th>Ù…</th><th>Ø±Ù‚Ù… Ø§Ù„ÙˆÙ„ÙŠ</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡ÙˆÙŠØ©</th><th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
          <th>Ø§Ù„Ù…Ø¯ÙˆØ±</th><th>Ù1</th><th>Ù2</th><th>Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
        </tr>
      </thead><tbody>`;

      data.forEach((row, index) => {
        html += `<tr>
        <td><button onclick="this.closest('tr').remove()" style="color:red;border:none;background:none;cursor:pointer;">âœ–</button></td>
        <td contenteditable="true">${row.serial_no || ''}</td>
        <td contenteditable="true">${row.parent_code || ''}</td>
        <td contenteditable="true">${row.parent_name || ''}</td>
        <td contenteditable="true">${row.identity_no || ''}</td>
        <td contenteditable="true">${row.phone || ''}</td>
        <td contenteditable="true">${row.carried_balance || 0}</td>
        <td contenteditable="true">${row.term1_balance || 0}</td>
        <td contenteditable="true">${row.term2_balance || 0}</td>
        <td contenteditable="true" style="font-weight:bold;">${row.final_balance || 0}</td>
      </tr>`;
      });
      html += `</tbody></table>`;
      document.getElementById('gridContainer').innerHTML = html;
    }

    window.saveSettingsAndData = async (shouldClose, btnElement) => {
      // 1. Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
      await saveAppSettings();

      // 2. Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const emp = document.getElementById('importEmpSelect').value;
      const table = document.querySelector('#gridContainer table tbody');

      // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const newRecords = [];
      if (table && table.querySelectorAll('tr').length > 0) {
        const rows = table.querySelectorAll('tr');
        rows.forEach(tr => {
          const cells = tr.querySelectorAll('td');
          if (cells.length > 1) {
            newRecords.push({
              employee: emp,
              serial_no: parseInt(cells[1].innerText) || 0,
              parent_code: cells[2].innerText,
              parent_name: cells[3].innerText,
              identity_no: cells[4].innerText,
              phone: cells[5].innerText,
              carried_balance: cleanNumber(cells[6].innerText),
              term1_balance: cleanNumber(cells[7].innerText),
              term2_balance: cleanNumber(cells[8].innerText),
              final_balance: cleanNumber(cells[9].innerText)
            });
          }
        });
      }

      // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      const { error: delError } = await supabase.from('parents').delete().eq('employee', emp);

      if (delError) {
        console.error(delError);
        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©: ' + delError.message);
        return;
      }

      // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      if (newRecords.length > 0) {
        const { error: insError } = await supabase.from('parents').insert(newRecords);
        if (insError) {
          console.error(insError);
          alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ' + insError.message);
          return;
        }
      }

      if (shouldClose) {
        closeSettings();
      } else {
        if (btnElement) {
          const originalText = btnElement.innerText;
          const originalBg = btnElement.style.background;
          btnElement.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…";
          btnElement.style.background = "#4caf50";
          setTimeout(() => {
            btnElement.innerText = originalText;
            btnElement.style.background = originalBg;
          }, 1500);
        }
        await loadDataToGrid();
      }
    };

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù†
    window.openAdminPanel = () => {
      const pass = prompt("ğŸ”’ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:");
      if (pass === "admin123") {
        document.getElementById("adminScreen").style.display = "flex";
        loadAdminData();
      } else if (pass !== null) {
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ");
      }
    };

    window.closeAdminPanel = () => {
      document.getElementById("adminScreen").style.display = "none";
    };

    window.loadAdminData = async () => {
      const textarea = document.getElementById("adminDataInput");
      textarea.value = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";

      const { data, error } = await supabase
        .from("parents")
        .select("*")
        .order("employee")
        .order("serial_no");

      if (error) {
        textarea.value = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: " + error.message;
        console.error(error);
        return;
      }

      let text = "Ø§Ù„Ù…ÙˆØ¸Ù\tÙ…\tØ±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±\tØ§Ù„Ø§Ø³Ù…\tØ±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©\tØ§Ù„Ø¬ÙˆØ§Ù„\tØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø¯ÙˆØ±\tØ±ØµÙŠØ¯ Ù1\tØ±ØµÙŠØ¯ Ù2\tØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ\n";

      data.forEach(row => {
        text += `${row.employee || ''}\t${row.serial_no || ''}\t${row.parent_code || ''}\t${row.parent_name || ''}\t${row.identity_no || ''}\t${row.phone || ''}\t${row.carried_balance || 0}\t${row.term1_balance || 0}\t${row.term2_balance || 0}\t${row.final_balance || 0}\n`;
      });

      textarea.value = text;
    };

    window.saveAdminDataFull = async () => {
      if (!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹!")) return;

      const rawText = document.getElementById("adminDataInput").value;
      const rows = rawText.split("\n");
      const newRecords = [];

      const parseNum = (str) => {
        return cleanNumber(str);
      };

      for (let i = 0; i < rows.length; i++) {
        const line = rows[i].trim();
        if (!line) continue;

        const cols = line.split("\t");
        if (isNaN(parseInt(cols[1]))) continue;

        newRecords.push({
          employee: cols[0]?.trim() || 'emp1',
          serial_no: parseInt(cols[1]) || 0,
          parent_code: cols[2] || "",
          parent_name: cols[3] || "",
          identity_no: cols[4] || "",
          phone: cols[5] || "",
          carried_balance: parseNum(cols[6]),
          term1_balance: parseNum(cols[7]),
          term2_balance: parseNum(cols[8]),
          final_balance: parseNum(cols[9])
        });
      }

      const { error: delError } = await supabase.from("parents").delete().neq('id', -1);

      if (delError) {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©! Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø£Ù„ØºÙŠØª.");
        console.error(delError);
        return;
      }

      if (newRecords.length > 0) {
        const { error: insError } = await supabase.from("parents").insert(newRecords);
        if (insError) {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©!");
          console.error(insError);
        } else {
          alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! (${newRecords.length} Ø³Ø¬Ù„) âœ…`);
          closeAdminPanel();
        }
      } else {
        alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ù…Ø±Ø¨Ø¹ ÙØ§Ø±Øº).");
        closeAdminPanel();
      }
    };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù
    document.getElementById('importEmpSelect').addEventListener('change', () => {
      loadDataToGrid();
    });

    // Init
    loadSettings();
  </script>

</body>

</html>